<div id="a">
<span>ddfsfds<br/></span>
</div>
<div id="b">
<span class="hello">ddfsfds</span>
</div>
<script>

function normalize(a, b)
{
	if (a == null)
	{
		return;
	}
	if(a.isEqualNode(b))
	{
		if (typeof b.attributes != 'undefined')
		{
			for(var i = 0;i < b.attributes.length;i++)
			{
				b.removeAttribute(b.attributes[i].nodeName);
			}
		}
		b = removeAllTextNodes(b);
	}
	else if (a.tagName == b.tagName)
	{
		if (getNodeText(a) === getNodeText(b))
		{
		
	alert(getNodeText(a));
	alert(getNodeText(b));
			b = removeAllTextNodes(b);
		}
	
		if (typeof b.attributes != 'undefined' && typeof a.attributes != 'undefined')
		{
			var attributesToRemove = new Array();
		
			for(var j = 0;j < b.attributes.length;j++)
			{		
				attributesToRemove.push(b.attributes[j].nodeName);
			}
			
			for(var i = 0;i < a.attributes.length;i++)
			{
				var aAtt = a.attributes[i];
				attributesToRemove.pop(aAtt.nodeName);
				var found = false;
				
				for(var j = 0;j < b.attributes;j++)
				{
					var bAtt = b.attributes[j];
					if (aAtt.nodeName == bAtt.nodeName)
					{
						found = true;					

						if (aAtt.value != bAtt.value)
						{
							b.setAttribute(bAtt.nodeName, bAtt.value);
						}
						else
						{
							b.removeAttribute(bAtt.nodeName);
						}
					}
				}

				if (!found)
				{
					b.setAttribute(aAtt.nodeName, aAtt.value);
				}
			}
			
			for (var j = 0;j < attributesToRemove.length;j++)
			{		
				b.setAttribute(attributesToRemove[j], "");
			}
		}
	}
	else
	{
		if (!containsNode(b.parentNode, a))
		{
			if (typeof b.parentNode.attributes != 'undefined')
			{
				b.appendChild(a.cloneNode(true));
			}
		}
		else
		{
			var parent = b.parentNode;
			parent.removeChild(b);
		}
	}
	var maximum = a.childNodes.length;
	if (maximum < b.childNodes.length)
	{
		maximum = b.childNodes.length;
	}
	
	var previousA = a;
	var previousB = b;
	for(var i = 0;i < maximum;i++)
	{
		var nextA = a.childNodes[i];
		var nextB = b.childNodes[i];
		if (nextB == null)
		{
			nextB = previousB;
		}
		else
		{
			previousB = nextB;
		}
		if (nextA == null)
		{
			nextA = previousA;
		}
		else
		{
			previousA = nextA;
		}
		normalize(nextA, nextB);
	}	
}

function getNodeText(o)
{
	var text = "";
	for (var i = 0; i < o.childNodes.length; i++) {
		var curNode = o.childNodes[i];
		if (curNode.nodeType == 3) {
			text += curNode.nodeValue;
		}
	}
	return text;
}

function removeAllTextNodes(o)
{
	for (var i = 0; i < o.childNodes.length; i++) {
		var curNode = o.childNodes[i];
		if (curNode.nodeType == 3) {
			o.removeChild(curNode);
		}
	}
	return o;
}

function containsNode(haystack, needle)
{
	for(var i = 0;i < haystack.childNodes;i++)
	{
		if(needle.isEqualNode(haystack.childNodes[i]))
		{
			return true;
		}
	}
	return false;
}

normalize(document.getElementById('a'), document.getElementById('b'));
</script>